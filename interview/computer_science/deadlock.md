# 데드락의 발생조건과 세마포어, 뮤텍스


## 데드락(Deadlock)

프로세스가 자원을 얻지 못해 다음 처리를 하지 못하는 상태. 
시스템적으로 한정된 자원을 여러 곳에서 사용하려고 할 때 발생한다.

![deadlock](img/deadlock.png)

<br>

## 데드락 발생 조건

#### 1. 상호배제 (Mutual Exclusion)
- 한 자원에 대해 동시에 한 프로세스만 접근 가능
#### 2. 점유와 대기 (Hold and Wait)
- 자원을 점유한 상태에서 다른 프로세스의 자원이 반납되기를 기다림
#### 3. 비선점(Non Preemptive)
- 프로세스들은 다른 프로세스의 자원을 강제로 뺏어올 수 없음
#### 4. 환형대기 (Circle Wait)
- 각 프로세스가 순환적으로 다음 프로세스가 요구하는 자원을 점유함

<br>

## 데드락 해결 방법

#### 1. 예방 (Prevention)
- 상기 데드락 발생 조건 중 하나를 부정하여 사전에 예방하는 방법
  - <b>상호배제 부정</b>: 동시에 여러 프로세스 접근 가능. 실제로는 적용하기 어렵다.
  - <b>점유와 대기 부정</b>: 프로세스 시작 시 필요한 모든 자원을 동시에 가져온다.
  - <b>비선점 부정</b>: 다른 프로세스의 자원을 강제로 뺏어올 수 있도록 허용
  - <b>환형대기 부정</b>: 자원에 우선순위를 메겨 할당

#### 2. 회피 (Avoidance)
- Dijkstra의 은행원 알고리즘과 같이 모든 프로세스의 요구가 충족되도록 설계.
- 프로세스가 자원을 요구할 때, 시스템은 자원 할당 후에도 안정 상태로 남을지를 사전에 검사
  
#### 3. 회복 (Recovery)
- 교착상태를 허용한다. 탐지될 경우, 이를 회복하는 방식
- 교착상태를 일으킨 프로세스를 종료하거나, 할당된 자원을 해제한다.

#### 4. 무시 (Ignore)
- 대부분의 시스템에서 교착상태는 잘 일어나지 않는다.
- 교착상태를 예방/회피/탐지/복구 하는 데에 비용이 많이 들기 때문에 이를 내버려둔다.

<br>


## 세마포어 (Semaphore)

#### 개념
- 세마포어는 다익스트라가 제안한 교착상태 해법 중 하나로, 상호배제(Mutual Exclusion) 알고리즘을 기반으로 한다.
- 멀티프로그래밍 환경에서 공유자원에 접근할 때, atomic한 함수로 제어되는 정수 변수(세마포어)로 접근을 제어한다.
- 세마포어의 접근 제어에 따라 하나의 자원에는 제한된 수의 프로세스(스레드)만 접근할 수 있다.
- 세마포어는 

#### 작동 원리
- atomic하게 제어되는 정수 변수(세마포어)를 설정한다.
- 세마포어 값이 0이면 프로세스들은 해당 자원에 접근할 수 없다.
- 세마포어 값이 0보다 크면 프로세스는 자원에 접근하면서 세마포어 값을 1 감소시킨다.
- 프로세스는 자원 사용을 종료할 때 세마포어 값을 1 증가시킨다.

#### 바쁜 대기 (Busy Waiting)
- 바쁜 대기란 아무 것도 하지 않는 빈 반복문을 계속 돌다가, 임계 구역에 접근 가능해지면 접근하는 방식을 말한다.
- 빈 반복문을 계속 도는 동안 문맥교환이 발생하며 이로 인해 처리 효율이 떨어지는 단점이 있다.
- 또한, 어떤 프로세스를 먼저 임계구역에 진입시킬지 순서를 정하기 어렵다.

## Reference

- https://jwprogramming.tistory.com/12
- https://junsday.tistory.com/32
